<h3>STM8 - управление тактированием МК</h3>
<p>Перед началом работы программы всегда настраиваю тактирование МК. С помощью тактирования можно включать и отключать переферийные устройства МК. Это позволяет уменьшить энергопотребление, т.к. по сути мы отключаем не используемые устройства.</p>
<p>Управление тактированием производится с помощью регистров <b>CLK</b>. Смещение в памяти, относительно базового адреса регистров общего назначение (<b>0x5000</b>), для данных регистров равен <b>0x00C0</b>. То есть базовый адрес регистров <b>CLK_</b> равен <b>0x5000 + 0x00C0 = 0x50C0</b>.</p>
<hr>
<p>Первый регистр, это регистр:</p>
<p><b>CLK_ICKR</b> - регистр внутреннего тактирования. По умолчанию включен только бит 0. Адрес регистра - <b>0x50C0</b>. Значение по умолчанию - <b>0x01</b> Назначение битов:</p>
<pre>
  HSIEN [0] - включение/выключение HSI.
  HSIRDY[1] - только для чтения. Статус работы HSI.
  FHW   [2] - быстрое пробуждение.
  LSIEN [3] - вкл./выкл. LSI.
  LSIRDY[4] - только для чтения. Статус работы LSI.
  REGAH [5] - вкл./выкл. MVR (главного регулятора напряжения) в
              active-halt. Когда бит установлен, MVR выключен.
              Выход из active-halt дольше обычного.
</pre>
<p>Биты 6 и 7 зарезервированы. Эти источники не могут быть выключены, если они используется как мастер или как источник с пина CCO</p>
<p>Данный регистр управляет внутренними тактовыми генераторами. Биты 0 и 3 включают и выключают высокоскоростной и низкоскоростной внутренние генераторы.</p>
<hr>
<p><b>CLK_ECKR</b> - регистр внешнего тактирования. Адрес регистра - <b>0x50C1</b>. Значение по умолчанию - <b>0x00</b>. Назначение битов:</p>
<pre>
  HSEEN [0] - включает тактирование от внешнего генератора.
  HSERDY[1] - только чтение. Статус работы HSE.
</pre>
<p>Биты 2-7 зарезервированы. Этот источник не может быть выключен, если он используется как мастер или как источник с пина CCO</p>
<hr>
<p><b>CLK_CMSR</b> - регистр показывает, какой источник тактирования выбран в качестве мастера. Все биты только для чтения.</p>
<p>Адрес регистра - <b>0x50C3</b>.</p>
<p>Значение по умолчанию - <b>0xE1</b>.</p>
<p>Возможные значения:</p>
<pre>
  0xE1 (11100001) - в качестве мастера выбран HSI генератор
  0xD2 (11010010) - в качестве мастера выбран LSI генератор
  0xB4 (10110100) - в качестве мастера выбран HSE генератор
</pre>
<p>Значение в данном регистре выставляется аппаратно, после того, как источник полностью переключится.</p>
<hr>
<p><b>CLK_SWR</b> - данный регистр служит для выбора генератора, который будет использоваться в качестве мастера, но не переключает его.</p>
<p>Адрес регистра - <b>0x50C4</b>.</p>
<p>Значение по умолчанию - <b>0xE1</b>.</p>
<p>Возможные значения:</p>
<pre>
  0xE1 (11100001) - в качестве мастера выбран HSI генератор
  0xD2 (11010010) - в качестве мастера выбран LSI генератор
  0xB4 (10110100) - в качестве мастера выбран HSE генератор
</pre>
<p>Значения такие же, как и в CLK_CMSR. По сути, после переключения, происходит копирование значения отсюда-туда. Согласно мануалу регистр блокируется, пока идет переключение (бит SWBSY регистра CLK_SWCR установлен). Если выбран режим быстрого пробуждения (бит FHW в регистре CLK_ICKR включен), то при выходе из режимов halt/active-halt он будет устанавливаться в значение по умолчанию (0xE1)</p>
<hr>
<p><b>CLK_SWCR</b> - данный регистр служит для переключения источника тактирования.</p>
<p>Адрес регистра - <b>0x50C5</b>.</p>
<p>Назначение битов:</p>
<pre>
  SWBSY [0] - статус переключения. При обнулении программно,
              будет сброс/выкл. переключения.
  SWEN  [1] - старт/стоп переключения.
  SWIEN [2] - вкл. прерывания, после переключения источника.
  SWIF  [3] - флаг прерывания, после переключения источника.
      [4-7] - резерв.
</pre>
<p></p>
<hr>
<p><b>CLK_CKDIVR</b> - регистр управления предделителями частоты f<sub>HSI</sub> и f<sub>CPU</sub>.</p>
<p>Адрес регистра - <b>0x5C6</b></p>
<p>Значение по умолчанию - <b>0x18</b> (000 11 000)</p>
<pre>
  CPUDIV [0-2] - предделитель CPU
  HSIDIV [3-4] - предделитель HSI
         [5-7] - резерв
</pre>
<p>Возможные значения:</p>
<pre>
  HSIDIV:
    00 - без делителя
    01 - делитель на 2
    10 - делитель на 4
    11 - делитель на 8

  CPUDIV:
    000 - без делителя
    001 - /2
    010 - /4
    011 - /8
    100 - /16
    101 - /32
    110 - /64
    111 - /128
</pre>
<hr>
